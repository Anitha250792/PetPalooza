{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
body {
    background: #f6f7fb;
}
.container {
    max-width: 1200px;
}

/* Page Title */
.checkout-title {
    text-align: center;
    font-weight: 700;
    margin: 40px 0;
}

/* Layout spacing */
.checkout-wrapper {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}

/* Form Styling */
.checkout-form h4 {
    font-weight: 600;
    margin-bottom: 15px;
}

.checkout-form input[type="text"],
.checkout-form input[type="email"],
.checkout-form input[type="tel"] {
    width: 100%;
    padding: 12px 15px;
    border-radius: 10px;
    border: 1px solid #ddd;
    margin-bottom: 15px;
    transition: 0.2s;
}

.checkout-form input:focus {
    border-color: #1f4df0;
    outline: none;
    box-shadow: 0 0 0 3px rgba(31,77,240,0.1);
}

/* Checkboxes */
.form-check {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
}

.form-check-input {
    width: 18px !important;
    height: 18px !important;
    margin: 0;
}

.form-check label {
    margin: 0;
    font-size: 14px;
    line-height: 1.4;
}
/* Payment Boxes */
.payment-box {
    border: 1px solid #e3e3e3;
    padding: 18px;
    border-radius: 12px;
    margin-bottom: 15px;
    background: #fafafa;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: 0.2s;
}

.payment-box:hover {
    border-color: #1f4df0;
    background: #fff;
}

/* Button */
.order-now-btn {
    background: linear-gradient(135deg, #1f4df0, #163bc4);
    color: white;
    width: 100%;
    padding: 15px;
    font-weight: 600;
    border-radius: 40px;
    border: none;
    margin-top: 20px;
    font-size: 18px;
    transition: 0.3s;
}

.order-now-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(31,77,240,0.3);
}

/* Summary */
.summary-box {
    background: #e9f8e9;
    padding: 30px;
    border-radius: 15px;
    position: sticky;
    top: 120px;
    height: fit-content;
}

.summary-box img {
    width: 85px;
    border-radius: 10px;
}

.summary-box h4 {
    font-weight: 600;
    margin-bottom: 20px;
}

.summary-item {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.summary-item-details h6 {
    margin: 0;
    font-weight: 600;
}

.summary-item-details p {
    margin: 2px 0;
    font-size: 14px;
    color: #555;
}

.summary-line {
    display: flex;
    justify-content: space-between;
    margin: 12px 0;
    font-size: 15px;
}

.summary-line strong {
    font-size: 17px;
}

/* Discount */
.discount-wrapper {
    display: flex;
    gap: 10px;
    margin: 20px 0;
}

.discount-wrapper input {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
}

.discount-wrapper button {
    background: #1f4df0;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
}

/* Responsive */
@media(max-width: 992px) {
    .summary-box {
        margin-top: 30px;
        position: static;
    }
}

.payment-option {
    cursor: pointer;
}

.payment-option.active {
    border: 2px solid #1f4df0;
    background: #eef2ff;
    box-shadow: 0 5px 15px rgba(31,77,240,0.15);
}
</style>
<div class="container my-5" style="max-width:1200px;">

    <h2 class="checkout-title">Checkout</h2>

    <div class="checkout-wrapper">

        <div class="row">

            <!-- LEFT SIDE -->
            <div class="col-lg-7 mb-4 mb-lg-0">
                <div class="checkout-form">

                    <h4>Contact</h4>
                    <input type="email" placeholder="Email (for order updates)">

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="updates">
                        <label class="form-check-label" for="updates">Send me order updates, news and offers</label>
                    </div>

                    <h4 class="mt-4">Delivery</h4>

                    <input type="text" placeholder="Country/Region">

                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" placeholder="First name">
                        </div>
                        <div class="col-md-6">
                            <input type="text" placeholder="Last name">
                        </div>
                    </div>

                    <input type="text" placeholder="Address">
                    <input type="text" placeholder="Apartment, suite (Optional)">

                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" placeholder="City">
                        </div>
                        <div class="col-md-4">
                            <input type="text" placeholder="State">
                        </div>
                        <div class="col-md-4">
                            <input type="text" placeholder="Pincode">
                        </div>
                    </div>

                    <input type="text" placeholder="Phone">

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="saveInfo">
                        <label class="form-check-label" for="saveInfo">Save this information for next time</label>
                    </div>

                    <h4 class="mt-4">Choose your payment method</h4>

                    <div class="payment-box payment-option" data-method="online">
    <input type="radio" name="payment" value="online" hidden>
    <div>
        <strong>Secure transaction (UPI, Cards, Wallets)</strong>
    </div>
    <div>
        <img src="https://img.icons8.com/color/48/google-pay.png" height="28">
        <img src="https://img.icons8.com/color/48/mastercard-logo.png" height="28">
        <img src="https://img.icons8.com/color/48/visa.png" height="28">
    </div>
</div>

<div class="payment-box payment-option" data-method="cod">
    <input type="radio" name="payment" value="cod" hidden>
    <div>
        <strong>Cash on Delivery</strong>
    </div>
</div>

                    <button class="order-now-btn">Order Now</button>

                </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="col-lg-5">
                <div class="summary-box">

                    <h4>Order Summary</h4>

                    {% for item in items %}
                    <div class="summary-item">
                        {% if item.product.image %}
                            <img src="{{ item.product.image.url }}">
                        {% else %}
                            <img src="{% static 'images/default-product.png' %}">
                        {% endif %}

                        <div class="ms-3 summary-item-details">
                            <h6>{{ item.product.name }}</h6>
                            <p>₹ {{ item.product.price }}</p>
                            <p>Quantity {{ item.quantity }}</p>
                            <p>{{ item.product.weight }}</p>
                        </div>
                    </div>
                    {% endfor %}

                    <div class="discount-wrapper">
                        <input type="text" placeholder="Discount code or gift card">
                        <button>Apply</button>
                    </div>

                    <div class="summary-line">
                        <span>Sub total</span>
                        <span>₹ {{ subtotal }}</span>
                    </div>

                    <div class="summary-line">
                        <span>Shipping</span>
                        <span>₹ {{ shipping }}</span>
                    </div>

                    <hr>

                    <div class="summary-line">
                        <strong>Total</strong>
                        <strong>₹ {{ total }}</strong>
                    </div>

                </div>
            </div>

        </div>

    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.querySelector('.order-now-btn').addEventListener('click', function(e) {

    let selectedPayment = document.querySelector('input[name="payment"]:checked');

    if (!selectedPayment) {
        alert("Please select a payment method");
        return;
    }

    if (selectedPayment.value === "cod") {
        alert("Order placed successfully with Cash on Delivery");
        return;
    }

    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ total|floatformat:2 }}" * 100,
        "currency": "INR",
        "name": "PetPalooza",
        "description": "Order Payment",
        "order_id": "{{ razorpay_order_id }}",
        "handler": function (response){
            alert("Payment Successful!");
            window.location.href = "/cart/thankyou/" + order_id + "/";
        },
        "theme": {
            "color": "#1f4df0"
        }
    };

    var rzp1 = new Razorpay(options);
    rzp1.open();
});
</script>
{% endblock %}